<div id="anim-growth" class="anim-container hidden">
  <canvas id="growth-canvas" width="400" height="300"></canvas>
  <div class="stats">
      Par√°metros: <span id="param-count">100</span>
  </div>
</div>

<script>
    const container = document.getElementById('anim-growth');
    const canvas = document.getElementById('growth-canvas') as HTMLCanvasElement;
    const ctx = canvas?.getContext('2d');
    const paramCount = document.getElementById('param-count');

    let nodes = [];
    let particles = [];
    let animationFrame;
    let params = 100;

    window.addEventListener('kidia:play-animation', (e) => {
        if ((e as CustomEvent).detail.name === 'growth') {
            play();
        }
    });

    function play() {
        if(!container || !ctx) return;
        container.classList.remove('hidden');
        
        // Reset
        nodes = createNodes(5);
        particles = [];
        params = 100;
        
        animate();
        
        // Add particles
        const interval = setInterval(() => {
            if(params > 1000000) {
                clearInterval(interval);
                setTimeout(() => container.classList.add('hidden'), 2000);
                return;
            }
            
            // Add particle
            particles.push({
                x: Math.random() < 0.5 ? 0 : 400,
                y: Math.random() * 300,
                vx: (Math.random() - 0.5) * 5,
                vy: (Math.random() - 0.5) * 5
            });
            
            // Grow params
            params += Math.floor(params * 0.1);
            paramCount.innerText = params.toLocaleString();
            
            // Sometimes add node
            if(Math.random() < 0.1) {
                nodes.push({
                    x: Math.random() * 400,
                    y: Math.random() * 300,
                    r: 0
                });
            }
        }, 100);
    }
    
    function createNodes(count) {
        return Array.from({length: count}, () => ({
            x: Math.random() * 400,
            y: Math.random() * 300,
            r: 0
        }));
    }

    function animate() {
        ctx.fillStyle = 'rgba(0,0,0,0.1)';
        ctx.fillRect(0, 0, 400, 300);
        
        // Draw connections
        ctx.strokeStyle = 'rgba(34, 211, 238, 0.2)';
        ctx.beginPath();
        for(let i=0; i<nodes.length; i++) {
            for(let j=i+1; j<nodes.length; j++) {
                const dx = nodes[i].x - nodes[j].x;
                const dy = nodes[i].y - nodes[j].y;
                if (Math.sqrt(dx*dx + dy*dy) < 100) {
                    ctx.moveTo(nodes[i].x, nodes[i].y);
                    ctx.lineTo(nodes[j].x, nodes[j].y);
                }
            }
        }
        ctx.stroke();
        
        // Draw Nodes
        nodes.forEach(n => {
            if(n.r < 5) n.r += 0.1;
            ctx.fillStyle = '#22d3ee';
            ctx.beginPath();
            ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
            ctx.fill();
        });
        
        // Draw Particles (Data)
        ctx.fillStyle = '#fff';
        particles.forEach((p, index) => {
            p.x += (200 - p.x) * 0.05; // Move to center
            p.y += (150 - p.y) * 0.05;
            
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Remove if close to center
            if(Math.abs(p.x - 200) < 5 && Math.abs(p.y - 150) < 5) {
                particles.splice(index, 1);
            }
        });

        if(!container.classList.contains('hidden')) {
            requestAnimationFrame(animate);
        }
    }
</script>

<style>
    .anim-container {
        position: fixed;
        bottom: 2rem;
        left: 2rem;
        background: #000;
        border: 1px solid #333;
        border-radius: 1rem;
        overflow: hidden;
        z-index: 2000;
    }
    .hidden { display: none !important; }
    
    .stats {
        position: absolute;
        top: 10px;
        left: 10px;
        color: lime;
        font-family: monospace;
        background: rgba(0,0,0,0.5);
        padding: 0.2rem 0.5rem;
    }
</style>
